{% extends 'base.html' %}

{% block content %}
    <h1>{{ resident.name }}</h1>
    <div class="card">
        <div class="card-body">
            <p><strong>DOB:</strong> {{ resident.dob }}</p>
            <p><strong>Medical Info:</strong> {{ resident.medical_info or 'N/A' }}</p>
            <p><strong>Emergency Contact:</strong> {{ resident.emergency_contact or 'N/A' }}</p>
            <a href="{{ url_for('daily_logs', resident_id=resident.id) }}" class="btn btn-primary">Daily Logs</a>
            <a href="{{ url_for('report', resident_id=resident.id) }}" class="btn btn-primary">View Report</a>
            {% if current_user.role == 'admin' %}
                <a href="{{ url_for('medications', resident_id=resident.id) }}" class="btn btn-secondary">Medications</a>
                <a href="{{ url_for('documents', resident_id=resident.id) }}" class="btn btn-secondary">Documents</a>
                <a href="{{ url_for('edit_resident', resident_id=resident.id) }}" class="btn btn-secondary">Edit Resident</a>
                <button onclick="deleteResident({{ resident.id }})" class="btn btn-danger">Delete Resident</button>
            {% endif %}
        </div>
    </div>
    {% if current_user.role == 'admin' %}
        <meta name="csrf-token" content="{{ csrf_token() }}">
        <script>
        async function deleteResident(residentId) {
            if (!confirm('Are you sure you want to delete this resident?')) return;
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            try {
                const response = await fetch(`/resident/${residentId}/delete`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': csrfToken,
                        'Content-Type': 'application/json'
                    }
                });
                if (response.ok) {
                    window.location.href = '{{ url_for("home") }}';
                } else {
                    alert('Error deleting resident');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to delete resident');
            }
        }
        </script>
    {% endif %}
{% endblock %}